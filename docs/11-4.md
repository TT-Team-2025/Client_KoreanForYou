# **í”„ë¡ íŠ¸ì—”ë“œ API í´ë” êµ¬ì¡° ë° ê°œë°œ ê°€ì´ë“œ**

> KoreanForYouÂ í”„ë¡œì íŠ¸ì˜ í”„ë¡ íŠ¸ì—”ë“œ API í´ë¼ì´ì–¸íŠ¸ êµ¬ì¶• ê°€ì´ë“œì…ë‹ˆë‹¤.
> 
> 
> ì´ ê°€ì´ë“œëŠ”Â **Axios**Â ê¸°ë°˜ìœ¼ë¡œ íƒ€ì… ì•ˆì „ì„±ì„ ë³´ì¥í•˜ë©°,Â **Types**,Â **API í•¨ìˆ˜**,Â **Custom Hooks**ë¥¼ ëª…í™•íˆ ë¶„ë¦¬í•˜ì—¬ ê´€ë¦¬í•©ë‹ˆë‹¤.
> 

---

## **ğŸ“ ê¶Œì¥ í´ë” êµ¬ì¡°**

```
src/
â”œâ”€â”€ api/                        # API í•¨ìˆ˜ ë° í´ë¼ì´ì–¸íŠ¸
â”‚   â”œâ”€â”€ client.ts              # Axios ì¸ìŠ¤í„´ìŠ¤ ë° ì¸í„°ì…‰í„° ì„¤ì •
â”‚   â”œâ”€â”€ auth.api.ts            # ì¸ì¦ ê´€ë ¨ API
â”‚   â”œâ”€â”€ users.api.ts           # ì‚¬ìš©ì ê´€ë ¨ API
â”‚   â”œâ”€â”€ chapters.api.ts        # ì±•í„° ê´€ë ¨ API
â”‚   â”œâ”€â”€ sentences.api.ts       # ë¬¸ì¥ ê´€ë ¨ API
â”‚   â”œâ”€â”€ scenarios.api.ts       # ì‹œë‚˜ë¦¬ì˜¤ ê´€ë ¨ API
â”‚   â”œâ”€â”€ community.api.ts       # ì»¤ë®¤ë‹ˆí‹° ê´€ë ¨ API
â”‚   â”œâ”€â”€ progress.api.ts        # í•™ìŠµ ì§„í–‰ ê´€ë ¨ API
â”‚   â”œâ”€â”€ stats.api.ts           # í†µê³„ ê´€ë ¨ API
â”‚   â”œâ”€â”€ feedback.api.ts        # í”¼ë“œë°± ê´€ë ¨ API
â”‚   â”œâ”€â”€ external.api.ts        # ì™¸ë¶€ API (TTS/STT) ê´€ë ¨
â”‚   â””â”€â”€ index.ts               # ëª¨ë“  API í†µí•© export
â”‚
â”œâ”€â”€ types/                      # TypeScript íƒ€ì… ì •ì˜
â”‚   â”œâ”€â”€ common.types.ts        # ê³µí†µ íƒ€ì… (BaseResponse, ErrorResponse ë“±)
â”‚   â”œâ”€â”€ auth.types.ts          # ì¸ì¦ ê´€ë ¨ íƒ€ì…
â”‚   â”œâ”€â”€ user.types.ts          # ì‚¬ìš©ì ê´€ë ¨ íƒ€ì…
â”‚   â”œâ”€â”€ chapter.types.ts       # ì±•í„° ê´€ë ¨ íƒ€ì…
â”‚   â”œâ”€â”€ sentence.types.ts      # ë¬¸ì¥ ê´€ë ¨ íƒ€ì…
â”‚   â”œâ”€â”€ scenario.types.ts      # ì‹œë‚˜ë¦¬ì˜¤ ê´€ë ¨ íƒ€ì…
â”‚   â”œâ”€â”€ community.types.ts     # ì»¤ë®¤ë‹ˆí‹° ê´€ë ¨ íƒ€ì…
â”‚   â”œâ”€â”€ progress.types.ts      # í•™ìŠµ ì§„í–‰ ê´€ë ¨ íƒ€ì…
â”‚   â”œâ”€â”€ stats.types.ts         # í†µê³„ ê´€ë ¨ íƒ€ì…
â”‚   â”œâ”€â”€ feedback.types.ts      # í”¼ë“œë°± ê´€ë ¨ íƒ€ì…
â”‚   â”œâ”€â”€ external.types.ts      # ì™¸ë¶€ API ê´€ë ¨ íƒ€ì…
â”‚   â””â”€â”€ index.ts               # ëª¨ë“  íƒ€ì… í†µí•© export
â”‚
â”œâ”€â”€ hooks/                      # React Custom Hooks (React Query/SWR ì‚¬ìš©)
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”œâ”€â”€ useLogin.ts
â”‚   â”‚   â”œâ”€â”€ useSignup.ts
â”‚   â”‚   â”œâ”€â”€ useLogout.ts
â”‚   â”‚   â””â”€â”€ useRefreshToken.ts
â”‚   â”œâ”€â”€ users/
â”‚   â”‚   â”œâ”€â”€ useUserProfile.ts
â”‚   â”‚   â”œâ”€â”€ useUpdateProfile.ts
â”‚   â”‚   â”œâ”€â”€ useUserStatus.ts
â”‚   â”‚   â””â”€â”€ useChangePassword.ts
â”‚   â”œâ”€â”€ chapters/
â”‚   â”‚   â”œâ”€â”€ useChapters.ts
â”‚   â”‚   â”œâ”€â”€ useChapter.ts
â”‚   â”‚   â””â”€â”€ useChapterSentences.ts
â”‚   â”œâ”€â”€ sentences/
â”‚   â”‚   â”œâ”€â”€ useSentence.ts
â”‚   â”‚   â””â”€â”€ useSimilarSentences.ts
â”‚   â”œâ”€â”€ scenarios/
â”‚   â”‚   â”œâ”€â”€ useStartScenario.ts
â”‚   â”‚   â”œâ”€â”€ useSendMessage.ts
â”‚   â”‚   â””â”€â”€ useSendVoiceMessage.ts
â”‚   â”œâ”€â”€ community/
â”‚   â”‚   â”œâ”€â”€ usePosts.ts
â”‚   â”‚   â”œâ”€â”€ usePost.ts
â”‚   â”‚   â”œâ”€â”€ useCreatePost.ts
â”‚   â”‚   â””â”€â”€ useReplies.ts
â”‚   â”œâ”€â”€ progress/
â”‚   â”‚   â”œâ”€â”€ useUserProgress.ts
â”‚   â”‚   â”œâ”€â”€ useChapterProgress.ts
â”‚   â”‚   â””â”€â”€ useSentenceProgress.ts
â”‚   â”œâ”€â”€ feedback/
â”‚   â”‚   â”œâ”€â”€ useChapterFeedback.ts
â”‚   â”‚   â”œâ”€â”€ useSentenceFeedback.ts
â”‚   â”‚   â””â”€â”€ useScenarioFeedback.ts
â”‚   â””â”€â”€ external/
â”‚       â”œâ”€â”€ useTTS.ts
â”‚       â””â”€â”€ useSTT.ts
â”‚
â””â”€â”€ utils/                      # ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
    â”œâ”€â”€ storage.ts             # ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ê´€ë¦¬
    â””â”€â”€ token.ts               # í† í° ê´€ë¦¬ ìœ í‹¸

```

---

## **ğŸ“‹ ë² ì´ìŠ¤ URL ë° API ì ‘ë‘ì‚¬**

```tsx
const BASE_URL = '/api';// ì‹¤ì œ ë°°í¬ ì‹œ í™˜ê²½ë³€ìˆ˜ë¡œ ê´€ë¦¬
```

ëª¨ë“  API ì—”ë“œí¬ì¸íŠ¸ëŠ”Â `/api`Â ì ‘ë‘ì‚¬ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

---

## **ğŸ”§ 1. API í´ë¼ì´ì–¸íŠ¸ ì„¤ì • (`api/client.ts`)**

Axios ì¸ìŠ¤í„´ìŠ¤ì™€ ì¸í„°ì…‰í„°ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.

```tsx
// api/client.tsimport axios, { AxiosInstance, AxiosError, InternalAxiosRequestConfig } from 'axios';
import { getAccessToken, getRefreshToken, setTokens, clearTokens } from '@/utils/token';

const BASE_URL = import.meta.env.VITE_API_BASE_URL || '/api';

// Axios ì¸ìŠ¤í„´ìŠ¤ ìƒì„±const apiClient: AxiosInstance = axios.create({
  baseURL: BASE_URL,
  timeout: 30000,
  headers: {
    'Content-Type': 'application/json',
  },
});

// ìš”ì²­ ì¸í„°ì…‰í„°: í† í° ìë™ ì¶”ê°€
apiClient.interceptors.request.use(
  (config: InternalAxiosRequestConfig) => {
    const token = getAccessToken();
    if (token && config.headers) {
      config.headers.Authorization = `Bearer ${token}`;
    }
    return config;
  },
  (error: AxiosError) => {
    return Promise.reject(error);
  }
);

// ì‘ë‹µ ì¸í„°ì…‰í„°: í† í° ê°±ì‹  ë° ì—ëŸ¬ ì²˜ë¦¬
apiClient.interceptors.response.use(
  (response) => response,
  async (error: AxiosError) => {
    const originalRequest = error.config as InternalAxiosRequestConfig & { _retry?: boolean };

// 401 ì—ëŸ¬ && ì¬ì‹œë„ ì•ˆí•¨if (error.response?.status === 401 && !originalRequest._retry) {
      originalRequest._retry = true;

      const refreshToken = getRefreshToken();
      if (refreshToken) {
        try {
// í† í° ê°±ì‹  API í˜¸ì¶œconst { data } = await axios.post(`${BASE_URL}/auth/refresh`, {
            refresh_token: refreshToken,
          });

// ìƒˆ í† í° ì €ì¥setTokens(data.access_token, data.refresh_token);

// ì›ë˜ ìš”ì²­ ì¬ì‹œë„if (originalRequest.headers) {
            originalRequest.headers.Authorization = `Bearer ${data.access_token}`;
          }
          return apiClient.request(originalRequest);
        } catch (refreshError) {
// í† í° ê°±ì‹  ì‹¤íŒ¨ â†’ ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬clearTokens();
          window.location.href = '/login';
          return Promise.reject(refreshError);
        }
      } else {
// refresh token ì—†ìŒ â†’ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œclearTokens();
        window.location.href = '/login';
      }
    }

    return Promise.reject(error);
  }
);

export default apiClient;

```

---

## **ğŸ“¦ 2. ê³µí†µ íƒ€ì… ì •ì˜ (`types/common.types.ts`)**

ëª¨ë“  APIì—ì„œ ê³µí†µìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” íƒ€ì…ì„ ì •ì˜í•©ë‹ˆë‹¤.

```tsx
// types/common.types.ts/**
 * ê¸°ë³¸ API ì‘ë‹µ í˜•ì‹
 */export interface BaseResponse<T = any> {
  success: boolean;
  message: string;
  data?: T;
}

/**
 * ì—ëŸ¬ ì‘ë‹µ í˜•ì‹
 */export interface ErrorResponse {
  success: false;
  message: string;
  error_code?: string;
  details?: Record<string, any>;
}

/**
 * í˜ì´ì§€ë„¤ì´ì…˜ íŒŒë¼ë¯¸í„°
 */export interface PaginationParams {
  page?: number;
  size?: number;
}

/**
 * í˜ì´ì§€ë„¤ì´ì…˜ ì‘ë‹µ
 */export interface PaginatedResponse<T> {
  items: T[];
  total: number;
  page: number;
  size: number;
  total_pages?: number;
}

/**
 * ì •ë ¬ ì˜µì…˜
 */export type SortOrder = 'asc' | 'desc';

/**
 * ë‚ ì§œ ë¬¸ìì—´ (ISO 8601 í˜•ì‹)
 */export type DateString = string;

```

---

## **ğŸ” 3. ì¸ì¦ API (`api/auth.api.ts`Â +Â `types/auth.types.ts`)**

### **íƒ€ì… ì •ì˜**

```tsx
// types/auth.types.tsimport { BaseResponse, DateString } from './common.types';

/**
 * íšŒì›ê°€ì… ìš”ì²­
 */export interface SignupRequest {
  email: string;
  password: string;// ìµœì†Œ 8ì
  nickname?: string;
  nationality?: string;
  job_id?: number;
  level_id?: number;
}

/**
 * ë¡œê·¸ì¸ ìš”ì²­ (OAuth2 Password Flow)
 */export interface LoginRequest {
  username: string;// emailpassword: string;
}

/**
 * í† í° ì‘ë‹µ
 */export interface TokenResponse {
  access_token: string;
  refresh_token: string;
  token_type: 'bearer';
  expires_in: number;// ì´ˆ ë‹¨ìœ„
}

/**
 * í† í° ê°±ì‹  ìš”ì²­
 */export interface RefreshTokenRequest {
  refresh_token: string;
}

```

### **API í•¨ìˆ˜**

```tsx
// api/auth.api.tsimport apiClient from './client';
import {
  SignupRequest,
  LoginRequest,
  TokenResponse,
  RefreshTokenRequest
} from '@/types/auth.types';
import { BaseResponse } from '@/types/common.types';

/**
 * íšŒì›ê°€ì…
 */export const signup = async (data: SignupRequest): Promise<BaseResponse> => {
  const response = await apiClient.post('/auth/signup', data);
  return response.data;
};

/**
 * ë¡œê·¸ì¸ (OAuth2)
 */export const login = async (email: string, password: string): Promise<TokenResponse> => {
  const formData = new URLSearchParams();
  formData.append('username', email);
  formData.append('password', password);

  const response = await apiClient.post('/auth/login', formData, {
    headers: {
      'Content-Type': 'application/x-www-form-urlencoded',
    },
  });
  return response.data;
};

/**
 * ë¡œê·¸ì•„ì›ƒ
 */export const logout = async (): Promise<BaseResponse> => {
  const response = await apiClient.post('/auth/logout');
  return response.data;
};

/**
 * í† í° ê°±ì‹ 
 */export const refreshToken = async (refreshToken: string): Promise<TokenResponse> => {
  const response = await apiClient.post('/auth/refresh', {
    refresh_token: refreshToken,
  });
  return response.data;
};

```

### **Custom Hooks (React Query ì‚¬ìš©)**

```tsx
// hooks/auth/useLogin.tsimport { useMutation, UseMutationResult } from '@tanstack/react-query';
import { login } from '@/api/auth.api';
import { TokenResponse } from '@/types/auth.types';
import { setTokens } from '@/utils/token';

interface LoginParams {
  email: string;
  password: string;
}

export const useLogin = (): UseMutationResult<TokenResponse, Error, LoginParams> => {
  return useMutation({
    mutationFn: ({ email, password }: LoginParams) => login(email, password),
    onSuccess: (data) => {
// í† í° ì €ì¥setTokens(data.access_token, data.refresh_token);
    },
  });
};

```

```tsx
// hooks/auth/useSignup.tsimport { useMutation, UseMutationResult } from '@tanstack/react-query';
import { signup } from '@/api/auth.api';
import { SignupRequest } from '@/types/auth.types';
import { BaseResponse } from '@/types/common.types';

export const useSignup = (): UseMutationResult<BaseResponse, Error, SignupRequest> => {
  return useMutation({
    mutationFn: signup,
  });
};

```

```tsx
// hooks/auth/useLogout.tsimport { useMutation, UseMutationResult } from '@tanstack/react-query';
import { logout } from '@/api/auth.api';
import { clearTokens } from '@/utils/token';
import { BaseResponse } from '@/types/common.types';

export const useLogout = (): UseMutationResult<BaseResponse, Error, void> => {
  return useMutation({
    mutationFn: logout,
    onSuccess: () => {
      clearTokens();
      window.location.href = '/login';
    },
  });
};

```

---

## **ğŸ‘¤ 4. ì‚¬ìš©ì API (`api/users.api.ts`Â +Â `types/user.types.ts`)**

### **íƒ€ì… ì •ì˜**

```tsx
// types/user.types.tsimport { BaseResponse, DateString } from './common.types';

/**
 * ì‚¬ìš©ì ì •ë³´
 */export interface User {
  user_id: number;
  email: string;
  nickname?: string;
  nationality?: string;
  job_id?: number;
  level_id?: number;
  profile_img?: string;
  created_at: DateString;
  updated_at: DateString;
}

/**
 * ì‚¬ìš©ì ì •ë³´ ìˆ˜ì •
 */export interface UserUpdate {
  nickname?: string;
  nationality?: string;
  job_id?: number;
  level_id?: number;
}

/**
 * ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
 */export interface UserPasswordChange {
  current_password: string;
  new_password: string;// ìµœì†Œ 8ì
}

/**
 * ëª¨êµ­ì–´ ë³€ê²½
 */export interface UserLanguageChange {
  nationality: string;
}

/**
 * ì§ë¬´ ë³€ê²½
 */export interface UserJobChange {
  job_id: number;
}

/**
 * ì‚¬ìš©ì í•™ìŠµ ìƒíƒœ
 */export interface UserStatus {
  user_id: number;
  total_study_time: number;
  total_sentences_completed: number;
  total_scenarios_completed: number;
  average_score?: number;
  current_access_days: number;
  longest_access_days: number;
  last_study_date?: DateString;
}

```

### **API í•¨ìˆ˜**

```tsx
// api/users.api.tsimport apiClient from './client';
import {
  User,
  UserUpdate,
  UserPasswordChange,
  UserLanguageChange,
  UserJobChange,
  UserStatus,
} from '@/types/user.types';
import { BaseResponse } from '@/types/common.types';

/**
 * ë‚´ ì •ë³´ ì¡°íšŒ
 */export const getMyProfile = async (): Promise<User> => {
  const response = await apiClient.get('/users/');
  return response.data;
};

/**
 * ì‚¬ìš©ì ì •ë³´ ìˆ˜ì •
 */export const updateProfile = async (data: UserUpdate): Promise<BaseResponse> => {
  const response = await apiClient.put('/users/', data);
  return response.data;
};

/**
 * ë¹„ë°€ë²ˆí˜¸ ë³€ê²½
 */export const changePassword = async (data: UserPasswordChange): Promise<BaseResponse> => {
  const response = await apiClient.patch('/users/password', data);
  return response.data;
};

/**
 * ëª¨êµ­ì–´ ë³€ê²½
 */export const changeLanguage = async (data: UserLanguageChange): Promise<BaseResponse> => {
  const response = await apiClient.patch('/users/language', data);
  return response.data;
};

/**
 * ì§ë¬´ ë³€ê²½
 */export const changeJob = async (data: UserJobChange): Promise<BaseResponse> => {
  const response = await apiClient.patch('/users/job', data);
  return response.data;
};

/**
 * ì‚¬ìš©ì í•™ìŠµ ìƒíƒœ ì¡°íšŒ
 */export const getUserStatus = async (userId: number): Promise<UserStatus> => {
  const response = await apiClient.get(`/users/${userId}/status`);
  return response.data;
};

```

### **Custom Hooks**

```tsx
// hooks/users/useUserProfile.tsimport { useQuery, UseQueryResult } from '@tanstack/react-query';
import { getMyProfile } from '@/api/users.api';
import { User } from '@/types/user.types';

export const useUserProfile = (): UseQueryResult<User, Error> => {
  return useQuery({
    queryKey: ['user', 'profile'],
    queryFn: getMyProfile,
    staleTime: 1000 * 60 * 5,// 5ë¶„
  });
};

```

```tsx
// hooks/users/useUpdateProfile.tsimport { useMutation, UseMutationResult, useQueryClient } from '@tanstack/react-query';
import { updateProfile } from '@/api/users.api';
import { UserUpdate } from '@/types/user.types';
import { BaseResponse } from '@/types/common.types';

export const useUpdateProfile = (): UseMutationResult<BaseResponse, Error, UserUpdate> => {
  const queryClient = useQueryClient();

  return useMutation({
    mutationFn: updateProfile,
    onSuccess: () => {
// ì‚¬ìš©ì ì •ë³´ ìºì‹œ ë¬´íš¨í™”
      queryClient.invalidateQueries({ queryKey: ['user', 'profile'] });
    },
  });
};

```

```tsx
// hooks/users/useUserStatus.tsimport { useQuery, UseQueryResult } from '@tanstack/react-query';
import { getUserStatus } from '@/api/users.api';
import { UserStatus } from '@/types/user.types';

export const useUserStatus = (userId: number): UseQueryResult<UserStatus, Error> => {
  return useQuery({
    queryKey: ['user', 'status', userId],
    queryFn: () => getUserStatus(userId),
    enabled: !!userId,
  });
};

```

---

## **ğŸ“š 5. ì±•í„° API (`api/chapters.api.ts`Â +Â `types/chapter.types.ts`)**

### **íƒ€ì… ì •ì˜**

```tsx
// types/chapter.types.tsimport { BaseResponse, DateString, PaginationParams } from './common.types';

/**
 * ì±•í„° ì •ë³´
 */export interface Chapter {
  chapter_id: number;
  category_id: number;
  job_id?: number;
  level_id: number;
  title: string;
  description?: string;
  is_active: boolean;
  created_at: DateString;
}

/**
 * ì±•í„° ëª©ë¡ ì¡°íšŒ íŒŒë¼ë¯¸í„°
 */export interface ChapterQueryParams extends PaginationParams {
  job_id?: number;
  level_id?: number;
  group?: 'all' | 'completed' | 'incomplete';
}

/**
 * ì±•í„° ëª©ë¡ ì‘ë‹µ
 */export interface ChapterListResponse {
  chapters: Chapter[];
  total: number;
  page: number;
  size: number;
  group: 'all' | 'completed' | 'incomplete';
}

/**
 * ì±•í„° ìƒì„± (ê´€ë¦¬ììš©)
 */export interface ChapterCreate {
  category_id: number;
  job_id?: number;
  level_id: number;
  title: string;
  description?: string;
  is_active?: boolean;
}

/**
 * ì±•í„° ìˆ˜ì • (ê´€ë¦¬ììš©)
 */export interface ChapterUpdate {
  title?: string;
  description?: string;
  is_active?: boolean;
}

```

### **API í•¨ìˆ˜**

```tsx
// api/chapters.api.tsimport apiClient from './client';
import {
  Chapter,
  ChapterQueryParams,
  ChapterListResponse,
  ChapterCreate,
  ChapterUpdate,
} from '@/types/chapter.types';
import { BaseResponse } from '@/types/common.types';

/**
 * ì±•í„° ëª©ë¡ ì¡°íšŒ
 */export const getChapters = async (params?: ChapterQueryParams): Promise<ChapterListResponse> => {
  const response = await apiClient.get('/chapters/', { params });
  return response.data;
};

/**
 * ì±•í„° ìƒì„¸ ì¡°íšŒ
 */export const getChapter = async (chapterId: number): Promise<Chapter> => {
  const response = await apiClient.get(`/chapters/${chapterId}`);
  return response.data;
};

/**
 * ì±•í„° ìƒì„± (ê´€ë¦¬ì)
 */export const createChapter = async (data: ChapterCreate): Promise<BaseResponse> => {
  const response = await apiClient.post('/chapters/', data);
  return response.data;
};

/**
 * ì±•í„° ìˆ˜ì • (ê´€ë¦¬ì)
 */export const updateChapter = async (
  chapterId: number,
  data: ChapterUpdate
): Promise<BaseResponse> => {
  const response = await apiClient.put(`/chapters/${chapterId}`, data);
  return response.data;
};

/**
 * ì±•í„° ì‚­ì œ (ê´€ë¦¬ì)
 */export const deleteChapter = async (chapterId: number): Promise<BaseResponse> => {
  const response = await apiClient.delete(`/chapters/${chapterId}`);
  return response.data;
};

```

### **Custom Hooks**

```tsx
// hooks/chapters/useChapters.tsimport { useQuery, UseQueryResult } from '@tanstack/react-query';
import { getChapters } from '@/api/chapters.api';
import { ChapterQueryParams, ChapterListResponse } from '@/types/chapter.types';

export const useChapters = (
  params?: ChapterQueryParams
): UseQueryResult<ChapterListResponse, Error> => {
  return useQuery({
    queryKey: ['chapters', params],
    queryFn: () => getChapters(params),
  });
};

```

```tsx
// hooks/chapters/useChapter.tsimport { useQuery, UseQueryResult } from '@tanstack/react-query';
import { getChapter } from '@/api/chapters.api';
import { Chapter } from '@/types/chapter.types';

export const useChapter = (chapterId: number): UseQueryResult<Chapter, Error> => {
  return useQuery({
    queryKey: ['chapter', chapterId],
    queryFn: () => getChapter(chapterId),
    enabled: !!chapterId,
  });
};

```

---

## **ğŸ’¬ 6. ë¬¸ì¥ API (`api/sentences.api.ts`Â +Â `types/sentence.types.ts`)**

### **íƒ€ì… ì •ì˜**

```tsx
// types/sentence.types.tsimport { BaseResponse, DateString, PaginationParams } from './common.types';

/**
 * ë¬¸ì¥ ì •ë³´
 */export interface Sentence {
  sentence_id: number;
  chapter_id: number;
  content: string;
  translated_content?: string;
  tts_url?: string;
  created_at: DateString;
}

/**
 * ë¬¸ì¥ ëª©ë¡ ì‘ë‹µ
 */export interface SentenceListResponse {
  sentences: Sentence[];
  total: number;
  page: number;
  size: number;
}

/**
 * ìœ ì‚¬ ë¬¸ì¥
 */export interface SimilarSentence {
  similar_sentence_id: number;
  sentence_id: number;
  content: string;
  translated_content?: string;
  similarity_type: 'ë™ì˜ì–´' | 'ìœ ì‚¬í‘œí˜„' | 'ë‚œì´ë„ì¡°ì •' | 'ìƒí™©ë³€í˜•';
  count: number;
  created_at: DateString;
}

/**
 * ë¬¸ì¥ ìƒì„±/ìˆ˜ì • (ê´€ë¦¬ììš©)
 */export interface SentenceCreate {
  chapter_id: number;
  content: string;
  translated_content?: string;
}

```

### **API í•¨ìˆ˜**

```tsx
// api/sentences.api.tsimport apiClient from './client';
import {
  Sentence,
  SentenceListResponse,
  SimilarSentence,
  SentenceCreate,
} from '@/types/sentence.types';
import { BaseResponse, PaginationParams } from '@/types/common.types';

/**
 * ì±•í„° ë‚´ ë¬¸ì¥ ëª©ë¡ ì¡°íšŒ
 */export const getChapterSentences = async (
  chapterId: number,
  params?: PaginationParams
): Promise<SentenceListResponse> => {
  const response = await apiClient.get(`/chapters/${chapterId}/sentences`, { params });
  return response.data;
};

/**
 * ë¬¸ì¥ ì¡°íšŒ
 */export const getSentence = async (sentenceId: number): Promise<Sentence> => {
  const response = await apiClient.get(`/sentences/${sentenceId}`);
  return response.data;
};

/**
 * ìœ ì‚¬ ë¬¸ì¥ ì¡°íšŒ
 */export const getSimilarSentences = async (sentenceId: number): Promise<SimilarSentence[]> => {
  const response = await apiClient.get(`/sentences/${sentenceId}/similar`);
  return response.data;
};

/**
 * ë¬¸ì¥ ìˆ˜ì • (ê´€ë¦¬ì)
 */export const updateSentence = async (
  sentenceId: number,
  data: Partial<SentenceCreate>
): Promise<BaseResponse> => {
  const response = await apiClient.put(`/sentences/${sentenceId}`, data);
  return response.data;
};

/**
 * ë¬¸ì¥ ì‚­ì œ (ê´€ë¦¬ì)
 */export const deleteSentence = async (sentenceId: number): Promise<BaseResponse> => {
  const response = await apiClient.delete(`/sentences/${sentenceId}`);
  return response.data;
};

```

### **Custom Hooks**

```tsx
// hooks/sentences/useSentence.tsimport { useQuery, UseQueryResult } from '@tanstack/react-query';
import { getSentence } from '@/api/sentences.api';
import { Sentence } from '@/types/sentence.types';

export const useSentence = (sentenceId: number): UseQueryResult<Sentence, Error> => {
  return useQuery({
    queryKey: ['sentence', sentenceId],
    queryFn: () => getSentence(sentenceId),
    enabled: !!sentenceId,
  });
};

```

```tsx
// hooks/sentences/useSimilarSentences.tsimport { useQuery, UseQueryResult } from '@tanstack/react-query';
import { getSimilarSentences } from '@/api/sentences.api';
import { SimilarSentence } from '@/types/sentence.types';

export const useSimilarSentences = (
  sentenceId: number
): UseQueryResult<SimilarSentence[], Error> => {
  return useQuery({
    queryKey: ['sentence', sentenceId, 'similar'],
    queryFn: () => getSimilarSentences(sentenceId),
    enabled: !!sentenceId,
  });
};

```

---

## **ğŸ­ 7. ì‹œë‚˜ë¦¬ì˜¤ API (`api/scenarios.api.ts`Â +Â `types/scenario.types.ts`)**

### **íƒ€ì… ì •ì˜**

```tsx
// types/scenario.types.tsimport { BaseResponse } from './common.types';

/**
 * ì‹œë‚˜ë¦¬ì˜¤ ì„¸ì…˜ ì‹œì‘ ìš”ì²­
 */export interface StartScenarioRequest {
  topic: string;// ì˜ˆ: "í¸ì˜ì ì—ì„œ ê³„ì‚°í•˜ê¸°"my_role: string;// ë‚˜ì˜ ì—­í• ai_role: string;// AIì˜ ì—­í• 
  description?: string;// ìƒí™© ì„¤ëª…
}

/**
 * ì‹œë‚˜ë¦¬ì˜¤ ì„¸ì…˜ ì‹œì‘ ì‘ë‹µ
 */export interface StartScenarioResponse {
  session_id: string;// thread_idassistant: string;// AI ì²« ì‘ë‹µassistant_id: string;
}

/**
 * í…ìŠ¤íŠ¸ ë©”ì‹œì§€ ì „ì†¡ ìš”ì²­
 */export interface SendMessageRequest {
  thread_id: string;
  message: string;
}

/**
 * í…ìŠ¤íŠ¸ ë©”ì‹œì§€ ì‘ë‹µ
 */export interface SendMessageResponse {
  assistant: string;// AI ì‘ë‹µ
}

/**
 * ìŒì„± ë©”ì‹œì§€ ì‘ë‹µ
 */export interface SendVoiceMessageResponse {
  assistant: string;// AI ì‘ë‹µ í…ìŠ¤íŠ¸user_text: string;// STT ë³€í™˜ëœ ì‚¬ìš©ì ìŒì„±
  tts_filename?: string;// AI ì‘ë‹µ TTS íŒŒì¼ëª…
}

```

### **API í•¨ìˆ˜**

```tsx
// api/scenarios.api.tsimport apiClient from './client';
import {
  StartScenarioRequest,
  StartScenarioResponse,
  SendMessageRequest,
  SendMessageResponse,
  SendVoiceMessageResponse,
} from '@/types/scenario.types';

/**
 * ì‹œë‚˜ë¦¬ì˜¤ ì„¸ì…˜ ì‹œì‘
 */export const startScenarioSession = async (
  data: StartScenarioRequest
): Promise<StartScenarioResponse> => {
  const response = await apiClient.post('/scenarios/session/start', data);
  return response.data;
};

/**
 * í…ìŠ¤íŠ¸ ë©”ì‹œì§€ ì „ì†¡
 */export const sendMessage = async (data: SendMessageRequest): Promise<SendMessageResponse> => {
  const response = await apiClient.post('/scenarios/session/message', data);
  return response.data;
};

/**
 * ìŒì„± ë©”ì‹œì§€ ì „ì†¡ (STT + LLM + TTS)
 */export const sendVoiceMessage = async (
  threadId: string,
  audioFile: File
): Promise<SendVoiceMessageResponse> => {
  const formData = new FormData();
  formData.append('thread_id', threadId);
  formData.append('file', audioFile);

  const response = await apiClient.post('/scenarios/session/message/voice', formData, {
    headers: {
      'Content-Type': 'multipart/form-data',
    },
  });
  return response.data;
};

/**
 * TTS ì˜¤ë””ì˜¤ íŒŒì¼ ë‹¤ìš´ë¡œë“œ
 */export const getAudioFile = async (filename: string): Promise<Blob> => {
  const response = await apiClient.get(`/scenarios/audio/${filename}`, {
    responseType: 'blob',
  });
  return response.data;
};

```

### **Custom Hooks**

```tsx
// hooks/scenarios/useStartScenario.tsimport { useMutation, UseMutationResult } from '@tanstack/react-query';
import { startScenarioSession } from '@/api/scenarios.api';
import { StartScenarioRequest, StartScenarioResponse } from '@/types/scenario.types';

export const useStartScenario = (): UseMutationResult<
  StartScenarioResponse,
  Error,
  StartScenarioRequest
> => {
  return useMutation({
    mutationFn: startScenarioSession,
  });
};

```

```tsx
// hooks/scenarios/useSendMessage.tsimport { useMutation, UseMutationResult } from '@tanstack/react-query';
import { sendMessage } from '@/api/scenarios.api';
import { SendMessageRequest, SendMessageResponse } from '@/types/scenario.types';

export const useSendMessage = (): UseMutationResult<
  SendMessageResponse,
  Error,
  SendMessageRequest
> => {
  return useMutation({
    mutationFn: sendMessage,
  });
};

```

```tsx
// hooks/scenarios/useSendVoiceMessage.tsimport { useMutation, UseMutationResult } from '@tanstack/react-query';
import { sendVoiceMessage } from '@/api/scenarios.api';
import { SendVoiceMessageResponse } from '@/types/scenario.types';

interface SendVoiceParams {
  threadId: string;
  audioFile: File;
}

export const useSendVoiceMessage = (): UseMutationResult<
  SendVoiceMessageResponse,
  Error,
  SendVoiceParams
> => {
  return useMutation({
    mutationFn: ({ threadId, audioFile }: SendVoiceParams) =>
      sendVoiceMessage(threadId, audioFile),
  });
};

```

---

## **ğŸ˜ï¸ 8. ì»¤ë®¤ë‹ˆí‹° API (`api/community.api.ts`Â +Â `types/community.types.ts`)**

### **íƒ€ì… ì •ì˜**

```tsx
// types/community.types.tsimport { BaseResponse, DateString, PaginationParams } from './common.types';

/**
 * ê²Œì‹œê¸€ ì¹´í…Œê³ ë¦¬
 */export type PostCategory = 'Q&A' | 'ì •ë³´ê³µìœ ' | 'ììœ ê²Œì‹œíŒ' | 'ì·¨ì—…ì •ë³´';

/**
 * ê²Œì‹œê¸€ ì •ë ¬ ì˜µì…˜
 */export type PostSortOption = 'latest' | 'popular' | 'views';

/**
 * ê²Œì‹œê¸€ ì •ë³´
 */export interface Post {
  post_id: number;
  user_id: number;
  title: string;
  content: string;
  category: PostCategory;
  view_count: number;
  created_at: DateString;
  updated_at: DateString;
}

/**
 * ê²Œì‹œê¸€ ëª©ë¡ ì¡°íšŒ íŒŒë¼ë¯¸í„°
 */export interface PostQueryParams extends PaginationParams {
  category?: PostCategory;
  sort?: PostSortOption;
}

/**
 * ê²Œì‹œê¸€ ëª©ë¡ ì‘ë‹µ
 */export interface PostListResponse {
  posts: Post[];
  total: number;
  page: number;
  size: number;
}

/**
 * ê²Œì‹œê¸€ ì‘ì„±
 */export interface PostCreate {
  title: string;// 1-200ìcontent: string;// ìµœì†Œ 1ì
  category?: PostCategory;
}

/**
 * ê²Œì‹œê¸€ ìˆ˜ì •
 */export interface PostUpdate {
  title?: string;
  content?: string;
  category?: PostCategory;
}

/**
 * ëŒ“ê¸€ ì •ë³´
 */export interface Reply {
  reply_id: number;
  post_id: number;
  user_id: number;
  content: string;
  created_at: DateString;
  updated_at: DateString;
}

/**
 * ëŒ“ê¸€ ëª©ë¡ ì‘ë‹µ
 */export interface ReplyListResponse {
  replies: Reply[];
  total: number;
  page: number;
  size: number;
}

/**
 * ëŒ“ê¸€ ì‘ì„±
 */export interface ReplyCreate {
  content: string;// ìµœì†Œ 1ì
}

```

### **API í•¨ìˆ˜**

```tsx
// api/community.api.tsimport apiClient from './client';
import {
  Post,
  PostQueryParams,
  PostListResponse,
  PostCreate,
  PostUpdate,
  Reply,
  ReplyListResponse,
  ReplyCreate,
} from '@/types/community.types';
import { BaseResponse, PaginationParams } from '@/types/common.types';

/**
 * ê²Œì‹œê¸€ ëª©ë¡ ì¡°íšŒ
 */export const getPosts = async (params?: PostQueryParams): Promise<PostListResponse> => {
  const response = await apiClient.get('/posts/', { params });
  return response.data;
};

/**
 * ê²Œì‹œê¸€ ìƒì„¸ ì¡°íšŒ
 */export const getPost = async (postId: number): Promise<Post> => {
  const response = await apiClient.get(`/posts/${postId}`);
  return response.data;
};

/**
 * ê²Œì‹œê¸€ ì‘ì„±
 */export const createPost = async (data: PostCreate): Promise<BaseResponse> => {
  const response = await apiClient.post('/posts/', data);
  return response.data;
};

/**
 * ê²Œì‹œê¸€ ìˆ˜ì •
 */export const updatePost = async (postId: number, data: PostUpdate): Promise<BaseResponse> => {
  const response = await apiClient.put(`/posts/${postId}`, data);
  return response.data;
};

/**
 * ê²Œì‹œê¸€ ì‚­ì œ
 */export const deletePost = async (postId: number): Promise<BaseResponse> => {
  const response = await apiClient.delete(`/posts/${postId}`);
  return response.data;
};

/**
 * ëŒ“ê¸€ ëª©ë¡ ì¡°íšŒ
 */export const getReplies = async (
  postId: number,
  params?: PaginationParams
): Promise<ReplyListResponse> => {
  const response = await apiClient.get(`/posts/${postId}/replies`, { params });
  return response.data;
};

/**
 * ëŒ“ê¸€ ì‘ì„±
 */export const createReply = async (postId: number, data: ReplyCreate): Promise<BaseResponse> => {
  const response = await apiClient.post(`/posts/${postId}/replies`, data);
  return response.data;
};

/**
 * ëŒ“ê¸€ ì‚­ì œ
 */export const deleteReply = async (replyId: number): Promise<BaseResponse> => {
  const response = await apiClient.delete(`/posts/replies/${replyId}`);
  return response.data;
};

```

### **Custom Hooks**

```tsx
// hooks/community/usePosts.tsimport { useQuery, UseQueryResult } from '@tanstack/react-query';
import { getPosts } from '@/api/community.api';
import { PostQueryParams, PostListResponse } from '@/types/community.types';

export const usePosts = (params?: PostQueryParams): UseQueryResult<PostListResponse, Error> => {
  return useQuery({
    queryKey: ['posts', params],
    queryFn: () => getPosts(params),
  });
};

```

```tsx
// hooks/community/usePost.tsimport { useQuery, UseQueryResult } from '@tanstack/react-query';
import { getPost } from '@/api/community.api';
import { Post } from '@/types/community.types';

export const usePost = (postId: number): UseQueryResult<Post, Error> => {
  return useQuery({
    queryKey: ['post', postId],
    queryFn: () => getPost(postId),
    enabled: !!postId,
  });
};

```

```tsx
// hooks/community/useCreatePost.tsimport { useMutation, UseMutationResult, useQueryClient } from '@tanstack/react-query';
import { createPost } from '@/api/community.api';
import { PostCreate } from '@/types/community.types';
import { BaseResponse } from '@/types/common.types';

export const useCreatePost = (): UseMutationResult<BaseResponse, Error, PostCreate> => {
  const queryClient = useQueryClient();

  return useMutation({
    mutationFn: createPost,
    onSuccess: () => {
// ê²Œì‹œê¸€ ëª©ë¡ ìºì‹œ ë¬´íš¨í™”
      queryClient.invalidateQueries({ queryKey: ['posts'] });
    },
  });
};

```

---

## **ğŸ“Š 9. í•™ìŠµ ì§„í–‰ API (`api/progress.api.ts`Â +Â `types/progress.types.ts`)**

### **íƒ€ì… ì •ì˜**

```tsx
// types/progress.types.tsimport { BaseResponse, DateString } from './common.types';

/**
 * ì‚¬ìš©ì ì „ì²´ í•™ìŠµ ì§„í–‰ í˜„í™©
 */export interface ProgressStats {
  total_chapters: number;
  completed_chapters: number;
  total_sentences: number;
  completed_sentences: number;
  overall_progress: number;// Decimalstudy_time_minutes: number;
  last_study_date?: DateString;
}

/**
 * ì±•í„° ì§„í–‰ë¥ 
 */export interface ChapterProgress {
  chapter_id: number;
  chapter_title: string;
  completion_rate: number;// Decimal 0.00-100.00total_sentences: number;
  completed_sentences: number;
  last_access_at?: DateString;
}

/**
 * ë¬¸ì¥ ì§„í–‰ ìƒíƒœ
 */export interface SentenceProgress {
  progress_id: number;
  user_id: number;
  sentence_id: number;
  is_completed: boolean;
  stt_audio_url?: string;
  stt_transcript?: string;
  total_word_count?: number;
  correct_word_count?: number;
  recognized_word_count?: number;
  start_time?: DateString;
  end_time?: DateString;
  created_at: DateString;
}

/**
 * ì±•í„° ì§„í–‰ë¥  ì €ì¥/ê°±ì‹  ìš”ì²­
 */export interface UpdateChapterProgressRequest {
  completion_rate?: number;
  is_completed?: boolean;
}

/**
 * ë¬¸ì¥ ì™„ë£Œ ìƒíƒœ ì—…ë°ì´íŠ¸ ìš”ì²­
 */export interface UpdateSentenceProgressRequest {
  is_completed: boolean;
  stt_audio_url?: string;
  stt_transcript?: string;
}

```

### **API í•¨ìˆ˜**

```tsx
// api/progress.api.tsimport apiClient from './client';
import {
  ProgressStats,
  ChapterProgress,
  SentenceProgress,
  UpdateChapterProgressRequest,
  UpdateSentenceProgressRequest,
} from '@/types/progress.types';
import { BaseResponse } from '@/types/common.types';

/**
 * ì‚¬ìš©ì ì „ì²´ í•™ìŠµ ì§„í–‰ í˜„í™©
 */export const getUserProgress = async (userId: number): Promise<ProgressStats> => {
  const response = await apiClient.get(`/progress/users/${userId}`);
  return response.data;
};

/**
 * ì±•í„° ì§„í–‰ë¥  ì¡°íšŒ
 */export const getChapterProgress = async (chapterId: number): Promise<ChapterProgress> => {
  const response = await apiClient.get(`/progress/chapters/${chapterId}`);
  return response.data;
};

/**
 * ì±•í„° ì§„í–‰ë¥  ì €ì¥/ê°±ì‹ 
 */export const updateChapterProgress = async (
  chapterId: number,
  data: UpdateChapterProgressRequest
): Promise<BaseResponse> => {
  const response = await apiClient.post(`/progress/chapters/${chapterId}`, data);
  return response.data;
};

/**
 * ë¬¸ì¥ ì§„í–‰ ìƒíƒœ ì¡°íšŒ
 */export const getSentenceProgress = async (sentenceId: number): Promise<SentenceProgress> => {
  const response = await apiClient.get(`/progress/sentences/${sentenceId}`);
  return response.data;
};

/**
 * ë¬¸ì¥ ì™„ë£Œ ìƒíƒœ ì—…ë°ì´íŠ¸
 */export const updateSentenceProgress = async (
  sentenceId: number,
  data: UpdateSentenceProgressRequest
): Promise<BaseResponse> => {
  const response = await apiClient.patch(`/progress/sentences/${sentenceId}`, data);
  return response.data;
};

```

### **Custom Hooks**

```tsx
// hooks/progress/useUserProgress.tsimport { useQuery, UseQueryResult } from '@tanstack/react-query';
import { getUserProgress } from '@/api/progress.api';
import { ProgressStats } from '@/types/progress.types';

export const useUserProgress = (userId: number): UseQueryResult<ProgressStats, Error> => {
  return useQuery({
    queryKey: ['progress', 'user', userId],
    queryFn: () => getUserProgress(userId),
    enabled: !!userId,
  });
};

```

```tsx
// hooks/progress/useChapterProgress.tsimport { useQuery, UseQueryResult } from '@tanstack/react-query';
import { getChapterProgress } from '@/api/progress.api';
import { ChapterProgress } from '@/types/progress.types';

export const useChapterProgress = (chapterId: number): UseQueryResult<ChapterProgress, Error> => {
  return useQuery({
    queryKey: ['progress', 'chapter', chapterId],
    queryFn: () => getChapterProgress(chapterId),
    enabled: !!chapterId,
  });
};

```

---

## **ğŸ“ˆ 10. í”¼ë“œë°± API (`api/feedback.api.ts`Â +Â `types/feedback.types.ts`)**

### **íƒ€ì… ì •ì˜**

```tsx
// types/feedback.types.tsimport { BaseResponse, DateString } from './common.types';

/**
 * ì±•í„° í”¼ë“œë°±
 */export interface ChapterFeedback {
  feedback_id: number;
  user_id: number;
  chapter_id: number;
  total_score?: number;// 0-100
  pronunciation_score?: number;// 0-100
  accuracy_score?: number;// 0-100
  completion_time?: number;
  total_sentences: number;
  completed_sentences: number;
  summary_feedback?: string;
  weaknesses?: string[];
  total_time?: number;
  created_at: DateString;
}

/**
 * ë¬¸ì¥ í”¼ë“œë°±
 */export interface SentenceFeedback {
  feedback_id: number;
  user_id: number;
  sentence_id: number;
  sentence_progress_id: number;
}

/**
 * ì‹œë‚˜ë¦¬ì˜¤ í”¼ë“œë°±
 */export interface ScenarioFeedback {
  feedback_id: number;
  user_id?: number;
  log_id: number;
  pronunciation_score?: number;// 0-100
  accuracy_score?: number;// 0-100
  fluency_score?: number;// 0-100
  completeness_score?: number;// 0-100
  total_score?: number;// 0-100
  comment?: string;
  detail_comment?: string[];
  created_at: DateString;
}

/**
 * ì±•í„° í”¼ë“œë°± ìƒì„± ìš”ì²­
 */export interface CreateChapterFeedbackRequest {
  total_score?: number;
  pronunciation_score?: number;
  accuracy_score?: number;
  completion_time?: number;
  summary_feedback?: string;
  weaknesses?: string[];
}

/**
 * ë¬¸ì¥ í”¼ë“œë°± ìƒì„± ìš”ì²­
 */export interface CreateSentenceFeedbackRequest {
  sentence_progress_id: number;
}

```

### **API í•¨ìˆ˜**

```tsx
// api/feedback.api.tsimport apiClient from './client';
import {
  ChapterFeedback,
  SentenceFeedback,
  ScenarioFeedback,
  CreateChapterFeedbackRequest,
  CreateSentenceFeedbackRequest,
} from '@/types/feedback.types';
import { BaseResponse } from '@/types/common.types';

/**
 * ì±•í„° í”¼ë“œë°± ì¡°íšŒ
 */export const getChapterFeedback = async (chapterId: number): Promise<ChapterFeedback> => {
  const response = await apiClient.get(`/feedback/chapters/${chapterId}`);
  return response.data;
};

/**
 * ì±•í„° í”¼ë“œë°± ìƒì„±
 */export const createChapterFeedback = async (
  chapterId: number,
  data: CreateChapterFeedbackRequest
): Promise<ChapterFeedback> => {
  const response = await apiClient.post(`/feedback/chapters/${chapterId}`, data);
  return response.data;
};

/**
 * ë¬¸ì¥ í”¼ë“œë°± ì¡°íšŒ
 */export const getSentenceFeedback = async (sentenceId: number): Promise<SentenceFeedback> => {
  const response = await apiClient.get(`/feedback/sentences/${sentenceId}`);
  return response.data;
};

/**
 * ë¬¸ì¥ í”¼ë“œë°± ìƒì„±
 */export const createSentenceFeedback = async (
  sentenceId: number,
  data: CreateSentenceFeedbackRequest
): Promise<BaseResponse> => {
  const response = await apiClient.post(`/feedback/sentences/${sentenceId}`, data);
  return response.data;
};

/**
 * ì‹œë‚˜ë¦¬ì˜¤ í”¼ë“œë°± ì¡°íšŒ
 */export const getScenarioFeedback = async (scenarioId: number): Promise<ScenarioFeedback> => {
  const response = await apiClient.get(`/feedback/scenarios/${scenarioId}`);
  return response.data;
};

```

### **Custom Hooks**

```tsx
// hooks/feedback/useChapterFeedback.tsimport { useQuery, UseQueryResult } from '@tanstack/react-query';
import { getChapterFeedback } from '@/api/feedback.api';
import { ChapterFeedback } from '@/types/feedback.types';

export const useChapterFeedback = (
  chapterId: number
): UseQueryResult<ChapterFeedback, Error> => {
  return useQuery({
    queryKey: ['feedback', 'chapter', chapterId],
    queryFn: () => getChapterFeedback(chapterId),
    enabled: !!chapterId,
  });
};

```

---

## **ğŸ”Š 11. ì™¸ë¶€ API (TTS/STT) (`api/external.api.ts`Â +Â `types/external.types.ts`)**

### **íƒ€ì… ì •ì˜**

```tsx
// types/external.types.tsimport { BaseResponse } from './common.types';

/**
 * TTS ìš”ì²­
 */export interface TTSRequest {
  text: string;
  speaker?: string;// ê¸°ë³¸: "nara"
  speed?: number;// ê¸°ë³¸: 0
  volume?: number;// ê¸°ë³¸: 0
  pitch?: number;// ê¸°ë³¸: 0
  emotion?: string;// ê¸°ë³¸: "neutral"
  format?: string;// ê¸°ë³¸: "mp3"
}

/**
 * STT ê²°ê³¼
 */export interface STTResult {
  transcribe_id: string;
  status: 'completed' | 'failed' | 'processing';
  results?: any[];// utterances ë“±
}

```

### **API í•¨ìˆ˜**

```tsx
// api/external.api.tsimport apiClient from './client';
import { TTSRequest, STTResult } from '@/types/external.types';
import { BaseResponse } from '@/types/common.types';

/**
 * TTS (í…ìŠ¤íŠ¸ â†’ ìŒì„±) - ë°”ì´íŠ¸ ìŠ¤íŠ¸ë¦¼
 */export const textToSpeech = async (data: TTSRequest): Promise<Blob> => {
  const response = await apiClient.post('/external/tts', data, {
    responseType: 'blob',
  });
  return response.data;
};

/**
 * TTS (í…ìŠ¤íŠ¸ â†’ ìŒì„± íŒŒì¼ ì €ì¥)
 */export const textToSpeechFile = async (text: string, filename: string): Promise<BaseResponse> => {
  const formData = new FormData();
  formData.append('text', text);
  formData.append('filename', filename);

  const response = await apiClient.post('/external/tts/file', formData, {
    headers: {
      'Content-Type': 'multipart/form-data',
    },
  });
  return response.data;
};

/**
 * STT (ìŒì„± â†’ í…ìŠ¤íŠ¸)
 */export const speechToText = async (audioFile: File): Promise<BaseResponse> => {
  const formData = new FormData();
  formData.append('file', audioFile);

  const response = await apiClient.post('/external/stt/file', formData, {
    headers: {
      'Content-Type': 'multipart/form-data',
    },
  });
  return response.data;
};

/**
 * STT ê²°ê³¼ ì¡°íšŒ
 */export const getSTTResult = async (transcribeId: string): Promise<STTResult> => {
  const response = await apiClient.get(`/external/stt/file/${transcribeId}`);
  return response.data;
};

```

### **Custom Hooks**

```tsx
// hooks/external/useTTS.tsimport { useMutation, UseMutationResult } from '@tanstack/react-query';
import { textToSpeech } from '@/api/external.api';
import { TTSRequest } from '@/types/external.types';

export const useTTS = (): UseMutationResult<Blob, Error, TTSRequest> => {
  return useMutation({
    mutationFn: textToSpeech,
  });
};

```

```tsx
// hooks/external/useSTT.tsimport { useMutation, UseMutationResult } from '@tanstack/react-query';
import { speechToText } from '@/api/external.api';
import { BaseResponse } from '@/types/common.types';

export const useSTT = (): UseMutationResult<BaseResponse, Error, File> => {
  return useMutation({
    mutationFn: speechToText,
  });
};

```

---

## **ğŸ› ï¸ 12. ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ (`utils/token.ts`,Â `utils/storage.ts`)**

### **í† í° ê´€ë¦¬**

```tsx
// utils/token.tsconst ACCESS_TOKEN_KEY = 'access_token';
const REFRESH_TOKEN_KEY = 'refresh_token';

/**
 * Access Token ê°€ì ¸ì˜¤ê¸°
 */export const getAccessToken = (): string | null => {
  return localStorage.getItem(ACCESS_TOKEN_KEY);
};

/**
 * Refresh Token ê°€ì ¸ì˜¤ê¸°
 */export const getRefreshToken = (): string | null => {
  return localStorage.getItem(REFRESH_TOKEN_KEY);
};

/**
 * í† í° ì €ì¥
 */export const setTokens = (accessToken: string, refreshToken: string): void => {
  localStorage.setItem(ACCESS_TOKEN_KEY, accessToken);
  localStorage.setItem(REFRESH_TOKEN_KEY, refreshToken);
};

/**
 * í† í° ì‚­ì œ
 */export const clearTokens = (): void => {
  localStorage.removeItem(ACCESS_TOKEN_KEY);
  localStorage.removeItem(REFRESH_TOKEN_KEY);
};

```

### **ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ê´€ë¦¬**

```tsx
// utils/storage.ts/**
 * ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ë°ì´í„° ì €ì¥
 */export const setItem = <T>(key: string, value: T): void => {
  try {
    localStorage.setItem(key, JSON.stringify(value));
  } catch (error) {
    console.error('Failed to save to localStorage:', error);
  }
};

/**
 * ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
 */export const getItem = <T>(key: string): T | null => {
  try {
    const item = localStorage.getItem(key);
    return item ? JSON.parse(item) : null;
  } catch (error) {
    console.error('Failed to load from localStorage:', error);
    return null;
  }
};

/**
 * ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë°ì´í„° ì‚­ì œ
 */export const removeItem = (key: string): void => {
  localStorage.removeItem(key);
};

/**
 * ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì „ì²´ ì‚­ì œ
 */export const clear = (): void => {
  localStorage.clear();
};

```

---

## **ğŸ“¦ 13. í†µí•© Export (`api/index.ts`,Â `types/index.ts`)**

### **API í†µí•©**

```tsx
// api/index.tsexport * from './auth.api';
export * from './users.api';
export * from './chapters.api';
export * from './sentences.api';
export * from './scenarios.api';
export * from './community.api';
export * from './progress.api';
export * from './stats.api';
export * from './feedback.api';
export * from './external.api';
export { default as apiClient } from './client';

```

### **íƒ€ì… í†µí•©**

```tsx
// types/index.tsexport * from './common.types';
export * from './auth.types';
export * from './user.types';
export * from './chapter.types';
export * from './sentence.types';
export * from './scenario.types';
export * from './community.types';
export * from './progress.types';
export * from './stats.types';
export * from './feedback.types';
export * from './external.types';

```

---

## **ğŸ¯ 14. ì‚¬ìš© ì˜ˆì‹œ**

### **ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©**

```tsx
// pages/ChapterList.tsximport React from 'react';
import { useChapters } from '@/hooks/chapters/useChapters';
import { ChapterQueryParams } from '@/types/chapter.types';

const ChapterList: React.FC = () => {
  const params: ChapterQueryParams = {
    page: 1,
    size: 10,
    group: 'all',
  };

  const { data, isLoading, error } = useChapters(params);

  if (isLoading) return <div>ë¡œë”© ì¤‘...</div>;
  if (error) return <div>ì—ëŸ¬ ë°œìƒ: {error.message}</div>;

  return (
    <div>
      <h1>ì±•í„° ëª©ë¡</h1>
      <ul>
        {data?.chapters.map((chapter) => (
          <li key={chapter.chapter_id}>
            {chapter.title} - {chapter.description}
          </li>
        ))}
      </ul>
    </div>
  );
};

export default ChapterList;

```

### **ë¡œê·¸ì¸ ì˜ˆì‹œ**

```tsx
// pages/Login.tsximport React, { useState } from 'react';
import { useLogin } from '@/hooks/auth/useLogin';
import { useNavigate } from 'react-router-dom';

const Login: React.FC = () => {
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const { mutate: login, isPending, error } = useLogin();
  const navigate = useNavigate();

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    login(
      { email, password },
      {
        onSuccess: () => {
          navigate('/dashboard');
        },
      }
    );
  };

  return (
    <form onSubmit={handleSubmit}>
      <input
        type="email"
        value={email}
        onChange={(e) => setEmail(e.target.value)}
        placeholder="ì´ë©”ì¼"
      />
      <input
        type="password"
        value={password}
        onChange={(e) => setPassword(e.target.value)}
        placeholder="ë¹„ë°€ë²ˆí˜¸"
      />
      <button type="submit" disabled={isPending}>
        {isPending ? 'ë¡œê·¸ì¸ ì¤‘...' : 'ë¡œê·¸ì¸'}
      </button>
      {error && <div>ë¡œê·¸ì¸ ì‹¤íŒ¨: {error.message}</div>}
    </form>
  );
};

export default Login;

```

---

## **ğŸ“ 15. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •**

`.env`Â íŒŒì¼ì— API ë² ì´ìŠ¤ URLì„ ì„¤ì •í•©ë‹ˆë‹¤.

```
# .env
VITE_API_BASE_URL=http://localhost:8000/api

```

í”„ë¡œë•ì…˜ í™˜ê²½:

```
# .env.production
VITE_API_BASE_URL=https://api.koreanforyou.com/api

```

---

## **ğŸ§ª 16. React Query ì„¤ì •**

```tsx
// App.tsx (ë˜ëŠ” main.tsx)import React from 'react';
import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
import { ReactQueryDevtools } from '@tanstack/react-query-devtools';

const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      retry: 1,
      refetchOnWindowFocus: false,
      staleTime: 1000 * 60,// 1ë¶„
    },
  },
});

function App() {
  return (
    <QueryClientProvider client={queryClient}>
      {/* ì•± ì»´í¬ë„ŒíŠ¸ */}
      <ReactQueryDevtools initialIsOpen={false} />
    </QueryClientProvider>
  );
}

export default App;

```

---

## **ğŸ“Œ 17. ì²´í¬ë¦¬ìŠ¤íŠ¸**

í”„ë¡ íŠ¸ì—”ë“œ API í´ë¼ì´ì–¸íŠ¸ë¥¼ êµ¬ì¶•í•  ë•Œ ë‹¤ìŒ ì‚¬í•­ì„ í™•ì¸í•˜ì„¸ìš”:

- [ ]  Axios ì¸ìŠ¤í„´ìŠ¤ ìƒì„± ë° ì¸í„°ì…‰í„° ì„¤ì •
- [ ]  ëª¨ë“  API ì—”ë“œí¬ì¸íŠ¸ì— ëŒ€í•œ íƒ€ì… ì •ì˜
- [ ]  API í•¨ìˆ˜ ì‘ì„± (ê° ë„ë©”ì¸ë³„ë¡œ ë¶„ë¦¬)
- [ ]  React Query/SWR ê¸°ë°˜ Custom Hooks ì‘ì„±
- [ ]  í† í° ê´€ë¦¬ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ êµ¬í˜„
- [ ]  í™˜ê²½ ë³€ìˆ˜ ì„¤ì • (.env)
- [ ]  ì—ëŸ¬ í•¸ë“¤ë§ ë° ì¬ì‹œë„ ë¡œì§
- [ ]  íŒŒì¼ ì—…ë¡œë“œ (multipart/form-data) ì²˜ë¦¬
- [ ]  ìŒì„±/ì´ë¯¸ì§€ ë“± ë°”ì´ë„ˆë¦¬ ì‘ë‹µ ì²˜ë¦¬ (Blob)
- [ ]  React Query Provider ì„¤ì •

---

## **ğŸš€ 18. ê¶Œì¥ ë¼ì´ë¸ŒëŸ¬ë¦¬**

```json
{
  "dependencies": {
    "axios": "^1.6.0",
    "@tanstack/react-query": "^5.0.0",
    "react": "^18.2.0",
    "react-dom": "^18.2.0"
  },
  "devDependencies": {
    "@tanstack/react-query-devtools": "^5.0.0",
    "typescript": "^5.0.0"
  }
}

```

---

## **ğŸ“š 19. ì°¸ê³  ìë£Œ**

- [Axios ê³µì‹ ë¬¸ì„œ](https://axios-http.com/)
- [TanStack Query (React Query) ê³µì‹ ë¬¸ì„œ](https://tanstack.com/query/latest)
- [TypeScript ê³µì‹ ë¬¸ì„œ](https://www.typescriptlang.org/)
- [FastAPI ê³µì‹ ë¬¸ì„œ](https://fastapi.tiangolo.com/)

---

## **âœ¨ 20. ë§ˆë¬´ë¦¬**

ì´ ê°€ì´ë“œëŠ”Â **KoreanForYou**Â ë°±ì—”ë“œ APIë¥¼ ê¸°ë°˜ìœ¼ë¡œ í”„ë¡ íŠ¸ì—”ë“œì—ì„œ íƒ€ì… ì•ˆì „ì„±ì„ ë³´ì¥í•˜ë©° íš¨ìœ¨ì ìœ¼ë¡œ APIë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆë„ë¡ êµ¬ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.

**í•µì‹¬ ì›ì¹™:**

1. **íƒ€ì… ì•ˆì „ì„±**: ëª¨ë“  API ìš”ì²­/ì‘ë‹µì— TypeScript íƒ€ì… ì ìš©
2. **ê´€ì‹¬ì‚¬ ë¶„ë¦¬**: Types, API, Hooksë¥¼ ëª…í™•íˆ ë¶„ë¦¬
3. **ì¬ì‚¬ìš©ì„±**: Custom Hooksë¡œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ìº¡ìŠí™”
4. **ì—ëŸ¬ ì²˜ë¦¬**: ì¸í„°ì…‰í„°ë¥¼ í†µí•œ ì¼ê´€ëœ ì—ëŸ¬ í•¸ë“¤ë§
5. **ìºì‹± ìµœì í™”**: React Queryë¥¼ í™œìš©í•œ ì„œë²„ ìƒíƒœ ê´€ë¦¬

ì´ êµ¬ì¡°ë¥¼ ë”°ë¼ êµ¬í˜„í•˜ë©´Â **í™•ì¥ ê°€ëŠ¥í•˜ê³  ìœ ì§€ë³´ìˆ˜í•˜ê¸° ì‰¬ìš´**Â í”„ë¡ íŠ¸ì—”ë“œ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

**ì‘ì„±ì¼**: 2025ë…„ 1ì›”Â **ì‘ì„±ì**: AI AssistantÂ **ë²„ì „**: 1.0.0